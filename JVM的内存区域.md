## 运行时数据区域

### 程序计数器

程序计数器是当前线程所执行的字节码的行号指示器

程序计数器是线程独立的

### 栈区

Java虚拟机栈也是线程私有的。虚拟机栈描述的是Java方法执行的内存模型，每个方法在执行时都会创建一个栈帧。方法从调用到执行完成的过程，对应着栈帧入栈到出栈的过程。栈帧中包括局部变量表、操作数栈、动态链接、方法出口等信息。

### 本地方法区

### 堆区

Java中的堆区是**所有线程共享**的一块内存区域，在虚拟机启动时就被创建。堆区主要保存：**对象实例**和**数组**。

### 方法区

Java中的方法区是**所有线程共享**的一块内存区域。方法区主要保存：已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等。

#### 运行时常量池

运行时常量池是方法区的一部分。用于存放字面量和符号引用。

## 对象的创建过程

1. 检查这个指令的参数能否在常量池中定位到一个类的符号引用，并检查这个符号引用代表的类是否已被加载。
2. JVM为新生对象分配内存，即把一块固定大小的内存从JAVA堆中划分出来。指针碰撞法、空闲列表法。
3. 将该对象分配到的内存空间都初始化为零值。（不包括对象头）
4. 将该对象自身的数据（对象类型、哈希码、GC分代年龄、锁状态等）保存到对象头中。
5. 调用<Init>方法完成代码中对象的初始化。

## 对象在内存中的布局

Java对象在内存中的布局有3部分，包括：对象头、实例数据和无意义填充。

1. 对象头（Mark Word）：对象头的内容包含两部分，第一部分是对象自身的运行时数据，该区域的大小是非固定的。另一部分是类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。
2. 实例数据：即代码中定义的该类各字段的内容，无论是从父类继承来的， 还是该类本身定义的。
3. 无意义填充。

## 对象的访问定位

对象的访问定位主要有**使用句柄**和**直接指针**两种。

- 使用句柄：Java堆划分出一块内存作为句柄池，而句柄中包含了该对象的实例数据和类型数据的具体地址。reference中存储该对象的句柄地址。不使用对象头中的类型指针。
- 直接指针：reference中直接存储该对象的具体地址，而对象的对象头中保存对象类型数据的地址。