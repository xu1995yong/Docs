## JVM中类的加载机制

虚拟机的类加载机制是指：JVM把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型的过程。

### 类在JVM中的生命周期
加载、验证、准备、解析、初始化、使用、卸载

### 什么时候类会被初始化（有且只有5种情况）
1. 使用new关键字实例化对象的时候、读取或设置一个类的(非final修饰的)静态字段的时候、调用一个类的静态方法的时候。
2. 使用java.lang.reflect包的方法对类进行反射调用的时候。
3. 当初始化一个类时，若发现其父类还没有初始化，则需要先对其父类进行初始化。
4. 当jvm启动时，需要先初始化要执行的主类（包含main方法的类）。
5. 使用jdk1.7中的java.lang.invoke.MethodHandle时。

### 加载阶段
1. 通过类的全限定名来读取定义该类的二进制流。
2. 将这个二进制流中的代表的静态存储结构转化为方法去的运行时数据结构。
3. 在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。

### 准备阶段
准备阶段，为**类变量**分配内存并设置类变量**初始值（数据类型的零值）**，类变量都将在方法区中进行分配。

### 解析阶段

### 初始化阶段
初始化阶段负责对类中所有**类变量赋值（代码定义的值）**和**执行静态语句块中的内容**。


## JVM中的类加载器
  JVM中的所有类加载器都拥有各自独立的类名称空间。也即：比较两个类是否"相等"，只有在这两个类是由同一个类加载器加载的前提下才有意义。否则即使两个类来源于同一个Class文件，且被同一个虚拟机加载，只要加载他们的类加载器不同，那这两个类必定不相等。

### 双亲委派模型
从JAVA开发者的角度看，类加载器可以分为3种：
​    1. 启动类加载器：负责加载JAVA_HOME\lib目录中或者参数指定的路径中的类库
​    2. 扩展类加载器
​    3. 应用程序类加载器：负责加载用户类路径上所指定的类库。


![âåäº²å§æ´¾æ¨¡åâçå¾çæç´¢ç"æ](https://images2018.cnblogs.com/blog/1371573/201804/1371573-20180411125544170-1010365637.png)

图中展示的类加载器之间的层次关系称为类加载器的双亲委派模型。双亲委派模型要求除了顶层的启动器加载器外，其余的类加载器都应该有自己的父类加载器。


**双亲委派模型的工作过程：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求时，子加载器才会尝试自己去加载。 **


双亲委派模型的好处：JAVA类随着它的类加载器一起具备了一种带有优先级的层次关系。例如类java.lang.Object，无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类。

